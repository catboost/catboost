# Development and contributions

## [Build from source](build-from-source.md) {#build-from-source}

## Run tests {#run-tests}

{% note warning %}

{% include [ya-make-to-cmake-switch](../_includes/work_src/reusage-installation/ya-make-to-cmake-switch.md) %}

{% endnote %}

### CMake-based build tests

- C/C++ libraries.

  C/C++ libraries contain tests for them in `ut` subdirectories in the source tree. For library in `x/y/z` the corresponding test code will be in `x/y/z/ut` and the target name will be `x-y-z-ut`.
  So, in order to run the test [run CMake](build-from-source.md#build-cmake) and then build the corresponding `x-y-z-ut` target. Building this target will produce an executable `${CMAKE_BUILD_DIR}/x/y/z/x-y-z-ut`. Run this executable to execute all the tests.

- {{ r-package }}

    1. Install additional R packages that are required to run tests:
        - `caret`
        - `dplyr`
        - `jsonlite`
        - `testthat`

    1. Open the `R-package` directory from the local copy of the {{ product }} repository.

    1. Run the following command:

        ```
        R CMD check .
        ```


    To run tests using the devtools package:

    1. Install [devtools](https://github.com/hadley/devtools).
    1. Run the following command from the R session:

        ```
        devtools::test()
        ```

- CLI

  1. Install [testpath](https://pypi.org/project/testpath/), [pytest](https://pytest.org/), [pandas](https://pypi.org/project/pandas/) and [catboost](https://pypi.org/project/catboost/) (used for reading column description files using `catboost.utils.read_cd`) packages for the python interpreter you intend to use.
  1. [Build](build-from-source#build-cmake) the CLI binary (target `catboost` for Ninja or another build tool) and a supplementary tool that is used to compare results generated as tests output with the canonical ones (target `limited_precision_dsv_diff` for Ninja or another build tool).
  1. Set the following environment variables:
      - `CMAKE_SOURCE_DIR` to the root of the local copy of the {{ product }} repository.
      - `CMAKE_BINARY_DIR` to the root for the build directory that has been generated by `CMake` and where the aformentioned targets have been built.
      - `TEST_OUTPUT_DIR` to the root for the directory where tests temporary data will be generated.
      - `HAVE_CUDA` - set to `1` if you want to run tests on GPU with `CUDA`, set to `0` otherwise.
  1. Open the `catboost/pytest` directory from the local copy of the {{ product }} repository.
  1. Run `python -m pytest`.

- Python package

  Tests will check `catboost` module for the `python` interpreter you run them with, so if you want to test `catboost` python package built from source [build and install it first](../installation/python-installation-method-build-from-source#installation).

  1. Install [testpath](https://pypi.org/project/testpath/) and [pytest](https://pytest.org/) packages for the python interpreter you intend to use.
  1. [Build](build-from-source#build-cmake) supplementary tools that are used to compare results generated as tests output with the canonical ones (targets `limited_precision_dsv_diff`, `limited_precision_json_diff`, `model_comparator` for Ninja or another build tool).
  1. Set the following environment variables:
      - `CMAKE_SOURCE_DIR` to the root of the local copy of the {{ product }} repository.
      - `CMAKE_BINARY_DIR` to the root for the build directory that has been generated by `CMake` and where the aformentioned targets have been built.
      - `TEST_OUTPUT_DIR` to the root for the directory where tests temporary data will be generated.
  1. Open the `catboost/python-package/ut/medium` directory from the local copy of the {{ product }} repository.
  1. Run `python -m pytest`.

  {% note warning %}

  Tests on GPU with `CUDA` will be run if and only if GPU with CUDA drivers installed is present.

  {% endnote %}

- CatBoost for Apache Spark

    See [building CatBoost for Apache Spark from source](../installation/spark-installation-build-from-source-maven.md). Use standard `mvn test` command.

### YaMake-based build tests

{% note warning %}

The following documentation describes running tests using Ya Make which is applicable only for versions prior to [this commit](https://github.com/catboost/catboost/commit/c5c642ca0b8e093336d0229ac4b14c78db3915bb).

{% endnote %}

{{ product }} provides tests that check the compliance of the canonical data with the resulting data.

The required steps for running these tests depend on the implementation.

{% list tabs %}

- Command-line version

    1. {% include [test-common-tests](../_includes/work_src/reusage-installation/common-tests.md) %}

        1. Open the `catboost/pytest` directory from the local copy of the {{ product }} repository.

        1. Run the following command:
        ```bash
        ../../ya make -t -A [-Z]
        ```

        {% include [test-replace-cannonical-files](../_includes/work_src/reusage-installation/replace-cannonical-files.md) %}

    1. {% include [test-gpu-specific-tests](../_includes/work_src/reusage-installation/gpu-specific-tests.md) %}

        1. Open the `catboost/pytest/cuda_tests` directory from the local copy of the {{ product }} repository.

        1. Run the following command:

        ```bash
        ../../../ya make -DCUDA_ROOT=<path_to_CUDA_SDK> -t -A [-Z]
        ```

        - {% include [test-path-to-cuda](../_includes/work_src/reusage-installation/path-to-cuda.md) %}

        - {% include [test-replace-cannonical-files](../_includes/work_src/reusage-installation/replace-cannonical-files.md) %}

    {% include [test-use-vcs-to-analyze-diff](../_includes/work_src/reusage-installation/use-vcs-to-analyze-diff.md) %}


- {{ python-package }}

    1. {% include [test-common-tests](../_includes/work_src/reusage-installation/common-tests.md) %}

        1. Open the `catboost/python-package/ut/medium` directory from the local copy of the {{ product }} repository.

        1. Run the following command:
        ```no-highlight
        ../../../../ya make -t -A [-Z]
        ```

        {% include [test-replace-cannonical-files](../_includes/work_src/reusage-installation/replace-cannonical-files.md) %}

    1. {% include [test-gpu-specific-tests](../_includes/work_src/reusage-installation/gpu-specific-tests.md) %}

        1. Open the `catboost/python-package/ut/medium/gpu` directory from the local copy of the {{ product }} repository.

        1. Run the following command:
        ```
        ../../../../../ya make -DCUDA_ROOT=<path_to_CUDA_SDK> -t -A [-Z]
        ```

        - {% include [test-path-to-cuda](../_includes/work_src/reusage-installation/path-to-cuda.md) %}

        - {% include [test-replace-cannonical-files](../_includes/work_src/reusage-installation/replace-cannonical-files.md) %}

    {% include [test-use-vcs-to-analyze-diff](../_includes/work_src/reusage-installation/use-vcs-to-analyze-diff.md) %}

- {{ r-package }}

    1. Install additional R packages that are required to run tests:
        - `caret`
        - `dplyr`
        - `jsonlite`
        - `testthat`

    1. Open the `R-package` directory from the local copy of the {{ product }} repository.

    1. Run the following command:

        ```
        R CMD check .
        ```


    To run tests using the devtools package:

    1. Install [devtools](https://github.com/hadley/devtools).
    1. Run the following command from the R session:

        ```
        devtools::test()
        ```

{% endlist %}


## Microsoft Visual Studio solution {#compiling-in-windows}

{% note warning %}

Ready Microsoft Visual Studio solution had been provided until [this commit](https://github.com/catboost/catboost/commit/cd63b6c7313a28bcb40cd0674d73e356ad633de4).

For versions after this commit it is recommended [to generate Microsoft Visual Studio 2019 solution using the corresponding CMake generator](../installation/build-native-artifacts.md#build-cmake-conan-ninja).

{% endnote %}

A solution for Visual Studio is available in the {{ product }} repository:

```
catboost/msvs/arcadia.sln
```


## Coding conventions {#coding-convention}

The following coding conventions must be followed in order to successfully contribute to the {{ product }} project:
- [C++ style guide](https://github.com/catboost/catboost/blob/master/CPP_STYLE_GUIDE.md)
- [pep8](https://www.python.org/dev/peps/pep-0008/) for Python


## Versioning conventions {#versioning-conventions}

Do not change the package version when submitting pull requests. Yandex uses an internal repository for this purpose.


## Yandex Contributor License Agreement {#yandex-cla}

To contribute to {{ product }} you need to read the Yandex CLA and indicate that you agree to its terms. Details of how to do that and the text of the CLA can be found in [CONTRIBUTING.md](https://github.com/catboost/catboost/blob/master/CONTRIBUTING.md).
